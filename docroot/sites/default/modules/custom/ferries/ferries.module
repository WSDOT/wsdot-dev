<?php
/**
 * @file
 * Module file for Ferries
 */

/**
 * Implements hook_block_info().
 */
function ferries_block_info() {
    $blocks = array();
    $blocks['schedule_by_route'] = array(
        'info' => t('Ferries: Sailing schedule by route'),
        'cache' => DRUPAL_NO_CACHE,
    );
    $blocks['make_reservations'] = array(
        'info' => t('Ferries: Make reservations'),
    );
    $blocks['buy_tickets'] = array(
        'info' => t('Ferries: Buy tickets'),
    );
    $blocks['ferry_alerts'] = array(
        'info' => t('Ferries: Ferry alerts'),
        'cache' => DRUPAL_NO_CACHE,
    );
    $blocks['rider_updates'] = array(
        'info' => t('Ferries: Rider updates'),
    );
    $blocks['live_ferry_status'] = array(
        'info' => t('Ferries: Live ferry status'),
    );
    $blocks['navigation_links'] = array(
        'info' => t('Ferries: Navigation links'),
    );
    $blocks['get_to_know_your_ferries'] = array(
        'info' => t('Ferries: Get to know your ferries'),
    );
    $blocks['online_tickets'] = array(
        'info' => t('Ferries: Tickets: Online tickets'),
    );
    $blocks['ticket_information'] = array(
        'info' => t('Ferries: Tickets: Ticket information'),
    );
    $blocks['calculate_fares'] = array(
        'info' => t('Ferries: Tickets: Calculate fares'),
    );
    $blocks['vehicle_reservations'] = array(
        'info' => t('Ferries: Tickets: Vehicle reservations'),
    );
    $blocks['passes'] = array(
        'info' => t('Ferries: Tickets: Passes'),
    );
    $blocks['refunds'] = array(
        'info' => t('Ferries: Tickets: Refunds'),
    );
    $blocks['wsf_blog'] = array(
        'info' => t('Ferries: L3 Footer: WSF Blog'),
    );
    $blocks['news_stories'] = array(
        'info' => t('Ferries: L3 Footer: News stories'),
    );
    $blocks['twitter'] = array(
        'info' => t('Ferries: L3 Footer: Twitter'),
    );

    return $blocks;
}

/**
 * Implements hook_block_view().
 */
function ferries_block_view($delta = '') {
    $block = array();
    switch($delta) {
        case 'schedule_by_route':
            $block['subject'] = t('<none>');
            $block['content'] = drupal_get_form('schedule_by_route_form');
            break;
        case 'make_reservations':
            $block['subject'] = t('<none>');
            $block['content'] = drupal_get_form('make_reservations_form');
            break;
        case 'buy_tickets':
            $block['subject'] = t('<none>');
            $block['content'] = drupal_get_form('buy_tickets_form');
            break;
        case 'ferry_alerts':
            $block['subject'] =  t('<none>');
            $block['content'] = build_ferry_alerts();
            break;
        case 'rider_updates':
            $block['subject'] =  t('<none>');
            $block['content'] = build_rider_updates();
            break;
        case 'live_ferry_status':
            $block['subject'] =  t('<none>');
            $block['content'] = build_live_ferry_status();
            break;
        case 'navigation_links':
            $block['subject'] =  t('<none>');
            $block['content'] = build_navigation_links();
            break;
        case 'get_to_know_your_ferries':
            $block['subject'] = t('<none>');
            $block['content'] = build_get_to_know_your_ferries();
            break;
        case 'online_tickets':
            $block['subject'] = t('<none>');
            $block['content'] = build_online_tickets();
            break;
        case 'ticket_information':
            $block['subject'] = t('<none>');
            $block['content'] = build_ticket_information();
            break;
        case 'calculate_fares':
            $block['subject'] = t('<none>');
            $block['content'] = build_calculate_fares();
            break;
        case 'vehicle_reservations':
            $block['subject'] = t('<none>');
            $block['content'] = build_vehicle_reservations();
            break;
        case 'passes':
            $block['subject'] = t('<none>');
            $block['content'] = build_passes();
            break;
        case 'refunds':
            $block['subject'] = t('<none>');
            $block['content'] = build_refunds();
            break;
        case 'wsf_blog':
            $block['subject'] = t('<none>');
            $block['content'] = build_wsf_blog();
            break;
        case 'news_stories':
            $block['subject'] = t('<none>');
            $block['content'] = build_news_stories();
            break;
        case 'twitter':
            $block['subject'] = t('<none>');
            $block['content'] = build_twitter();
            break;
    }

    return $block;
}

/* Beginning of home page tiles */
function schedule_by_route_form($form, &$form_state) {
    $routes = array();
    $json = file_get_contents("https://data.wsdot.wa.gov/ferries/WSFScheduledRoutes.js");
    $scheduledRoutes = json_decode($json, true);

    foreach ($scheduledRoutes as $route) {
        $routes[$route['RouteAbbrev']] = $route['Description'];
    }

    $form['#prefix'] = '<div class="action-box-shadow">';
    $form['#suffix'] = '</div>';
    $form['header'] = array(
        '#title' => t('Find your sailing schedule by route'),
        '#markup' => '<h2>Find your sailing schedule by route</h2>'
    );
    $form['#method'] = 'get';
    $form['#attributes']['name'] = 'schedule-by-route-form';
    $form['#attributes']['class'] = 'schedule-by-route';
    $form['#id'] = 'schedule-by-route';
    $form['#action'] = 'https://www.wsdot.com/ferries/schedule/scheduledetailbyroute.aspx';
    $form['route'] = array(
        '#type' => 'select',
        '#options' => $routes,
        '#required' => TRUE,
        '#empty_option' => t('Select Route'),
        '#attributes' => array('onchange' => 'this.form.submit();'),
    );
    
    return $form;
}

function make_reservations_form($form, &$form_state) {
    $form['#prefix'] = '<div class="action-box-shadow">';
    $form['#suffix'] = '</div>';
    $form['header'] = array(
        '#title' => t('Save a spot for your vehicle on some routes'),
        '#markup' => '<h2>Save a spot for your vehicle on some routes</h2>'
    );
    $form['#method'] = 'get';
    $form['#attributes']['name'] = 'make-reservations-form';
    $form['#attributes']['class'] = 'make-reservations';
    $form['#id'] = 'make-reservations';
    $form['#action'] = 'https://secureapps.wsdot.wa.gov/ferries/reservations/vehicle/default.aspx';
    $form['submit_button'] = array(
        '#type' => 'submit',
        '#value' => t('Make reservations'),
    );

    return $form;
}

function buy_tickets_form($form, &$form_state) {
    $form['#prefix'] = '<div class="action-box-shadow">';
    $form['#suffix'] = '</div>';
    $form['header'] = array(
        '#title' => t('Buy your tickets or passes online'),
        '#markup' => '<h2>Buy your tickets or passes online</h2>'
    );
    $form['#method'] = 'get';
    $form['#attributes']['name'] = 'buy-tickets-form';
    $form['#attributes']['class'] = 'buy-tickets';
    $form['#id'] = 'buy-tickets';
    $form['#action'] = 'https://wave2go.wsdot.com/webstore/landingPage?cg=21&c=76';
    $form['submit_button'] = array(
        '#type' => 'submit',
        '#value' => t('Buy tickets'),
    );

    return $form;
}

function build_ferry_alerts() {
    $json = file_get_contents("https://data.wsdot.wa.gov/ferries/WSFRouteAlert.js");
    $alert = json_decode($json, true);
    $publishDate = $alert[0]["PublishDate"];
    $alertFullTitle = $alert[0]['AlertFullTitle'];

    $output = "<div style='padding: 8px 13px 8px 13px; background-color: rgba(255,106,19,0.05);'>";
    $output .= "<h2 class='pane-title'>Ferry alerts</h2>";
    $output .= "<div>" . $publishDate . "</div>";
    $output .= "<div style='font-size: 1.125rem; font-weight: bold; padding: .75rem 0 1.5rem 0;'>" . $alertFullTitle . "</div>";
    $output .= "<ul class='info-box'>";
    $output .= "<li><a href='https://www.wsdot.wa.gov/ferries/schedule/bulletin.aspx'>All alerts</a></li>";
    $output .= "</ul>";
    $output .= "</div>";

    return $output;
}

function build_rider_updates() {
    $output = "<div style='padding: 8px 13px 8px 13px;'>";
    $output .= "<h2 class='pane-title'>Rider updates</h2>";
    $output .= "<div style='padding-bottom: 1.5rem;'>Lorem ipsum dolor sit amet, consectetur adipiscing elit. <a href='#'>Praesent aliquet pulvinar quam ac bibendum.</a></div>";
    $output .= "<ul class='info-box'>";
    $output .= "<li><a href='/ferries/rider-information/updates'>All rider updates</a></li>";
    $output .= "</ul>";
    $output .= "</div>";

    return $output;
}

function build_live_ferry_status() {
    $output = "<div style='padding: 8px 13px 8px 13px;background-color: rgba(151,215,0,0.05);'>";
    $output .= "<h2 class='pane-title'>Live ferry status</h2>";
    $output .= "<ul class='info-box'>";
    $output .= "<li><a href='https://www.wsdot.com/ferries/vesselwatch/'>Realtime ferry tracker</a></li>";
    $output .= "<li><a href='https://www.wsdot.wa.gov/ferries/vesselwatch/terminals.aspx'>Boarding status by terminal</a></li>";
    $output .= "</ul>";
    $output .="</div>";

    return $output;
}

function build_navigation_links() {
    $output = "<ul class='navigation-links'>";
    $output .= "<li><a href='/ferries/tickets'>Tickets</a></li>";
    $output .= "<li><a href='/ferries/schedule'>Schedules</a></li>";
    $output .= "<li><a href='/ferries/terminals'>Ferries and Terminals</a></li>";
    $output .= "<li><a href='/ferries/rider-information'>Rider Information</a></li>";
    $output .= "<li><a href='/ferries/about-us'>About Us</a></li>";
    $output .= "</ul>";

    return $output;
}

function build_get_to_know_your_ferries() {
    $output = "<div style='padding: 35px 13px 8px 13px;'>";
    $output .= "<h2 class='pane-title'>Get to know your ferries</h2>";
    $output .= "<div style='font-size: 1.25rem; font-weight: bold;'>All are welcome on Washington State Ferries</div>";
    $output .= "<p style='margin: 8px 0 24px 0;'>Here are some helpful tips on how to navigate the ferries.</p>";
    $output .= "<ul class='info-box'>";
    $output .= "<li><a href='/ferries/rider-information/first-time'>First time rider's guide</a></li>";
    $output .= "<li><a href='/ferries/rider-information/ada'>Disabilities and medical assistance</a></li>";
    $output .= "<li><a href='/ferries/rider-information/route-map'>Route map</a></li>";
    $output .= "<li><a href='/ferries/rider-information/canada'>Travel to Canada</a></li>";
    $output .= "<li><a href='/ferries/about-us/contact'>Contact Ferries</a></li>";
    $output .= "</ul>";
    $output .= "</div>";

    return $output;
}

/* Beginning of L3 landing page tiles */
function build_online_tickets() {
    $output = "<div class='l3-pane'>";
    $output .= "  <div class='l3-pane-image' style='background-image: url(/sites/default/themes/custom/ferries/images/online-tickets.jpg);'></div>";
    $output .= "  <div class='l3-pane-content'>";
    $output .= "    <h2 class='l3-pane-title'>Online tickets</h2>";
    $output .= "    <p>Buy your tickets online on our Wave2Go website.</p>";
    $output .= "  </div>";
    $output .= "  <div class='l3-pane-icon'>";
    $output .= "    <img src='/sites/default/themes/custom/ferries/images/bullet-inverse.png'>";
    $output .= "  </div>";
    $output .= "  <div class='cb'></div>";
    $output .= "</div>";

    return $output;
}

function build_ticket_information() {
    $output = "<div class='l3-pane'>";
    $output .= "  <div class='l3-pane-image' style='background-image: url(/sites/default/themes/custom/ferries/images/ticket-information.jpg);'></div>";
    $output .= "  <div class='l3-pane-content'>";
    $output .= "    <h2 class='l3-pane-title'>Ticket information</h2>";
    $output .= "    <p>Learn more about the types of tickets you can buy.</p>";
    $output .= "  </div>";
    $output .= "  <div class='l3-pane-icon'>";
    $output .= "    <img src='/sites/default/themes/custom/ferries/images/bullet-inverse.png'>";
    $output .= "  </div>";
    $output .= "  <div class='cb'></div>";
    $output .= "</div>";

    return $output;
}

function build_calculate_fares() {
    $output = "<div class='l3-pane'>";
    $output .= "  <div class='l3-pane-image' style='background-image: url(/sites/default/themes/custom/ferries/images/calculate-fares.jpg);'></div>";
    $output .= "  <div class='l3-pane-content'>";
    $output .= "    <h2 class='l3-pane-title'>Calculate fares</h2>";
    $output .= "    <p>Look up the cost of your ticket.</p>";
    $output .= "  </div>";
    $output .= "  <div class='l3-pane-icon'>";
    $output .= "    <img src='/sites/default/themes/custom/ferries/images/bullet-inverse.png'>";
    $output .= "  </div>";
    $output .= "  <div class='cb'></div>";
    $output .= "</div>";

    return $output;
}

function build_vehicle_reservations() {
    $output = "<div class='l3-pane'>";
    $output .= "  <div class='l3-pane-image' style='background-image: url(/sites/default/themes/custom/ferries/images/vehicle-reservations.jpg);'></div>";
    $output .= "  <div class='l3-pane-content'>";
    $output .= "    <h2 class='l3-pane-title'>Vehicle reservations</h2>";
    $output .= "    <p>Save a spot for your vehicle on select routes.</p>";
    $output .= "  </div>";
    $output .= "  <div class='l3-pane-icon'>";
    $output .= "    <img src='/sites/default/themes/custom/ferries/images/bullet-inverse.png'>";
    $output .= "  </div>";
    $output .= "  <div class='cb'></div>";
    $output .= "</div>";

    return $output;
}

function build_passes() {
    $output = "<div class='l3-pane'>";
    $output .= "  <div class='l3-pane-image' style='background-image: url(/sites/default/themes/custom/ferries/images/passes.jpg);'></div>";
    $output .= "  <div class='l3-pane-content'>";
    $output .= "    <h2 class='l3-pane-title'>Passes</h2>";
    $output .= "    <p>Frequent travelers, seniors, or people with disabilities can get discounted passes.</p>";
    $output .= "  </div>";
    $output .= "  <div class='l3-pane-icon'>";
    $output .= "    <img src='/sites/default/themes/custom/ferries/images/bullet-inverse.png'>";
    $output .= "  </div>";
    $output .= "  <div class='cb'></div>";
    $output .= "</div>";

    return $output;
}

function build_refunds() {
    $output = "<div class='l3-pane'>";
    $output .= "  <div class='l3-pane-image' style='background-image: url(/sites/default/themes/custom/ferries/images/refunds.jpg);'></div>";
    $output .= "  <div class='l3-pane-content'>";
    $output .= "    <h2 class='l3-pane-title'>Refunds</h2>";
    $output .= "    <p>Need to cancel your trip? View our refund policy.</p>";
    $output .= "  </div>";
    $output .= "  <div class='l3-pane-icon'>";
    $output .= "    <img src='/sites/default/themes/custom/ferries/images/bullet-inverse.png'>";
    $output .= "  </div>";
    $output .= "  <div class='cb'></div>";
    $output .= "</div>";

    return $output;
}

/* Beginning of L3 landing page footer tiles */
function build_wsf_blog() {
    $output = "<div style='padding-top: 35px;'>";
    $output .= "  <img src='/sites/default/themes/custom/ferries/images/wsf-blog.jpg' style='width: 220px; height: 157px; padding-bottom: 8px;'>";
    $output .= "  <div>";
    $output .= "    <h2 class='l3-footer-pane-title'>WSF Blog</h2>";
    $output .= "    <p>Check out our blog for all the latest updates on what’s going on with Washington State Ferries.</p>";
    $output .= "  </div>";
    $output .= "  <div>";
    $output .= "    <img src='/sites/default/themes/custom/ferries/images/bullet.png' style='float: right; padding: 10px;'>";
    $output .= "  </div>";
    $output .= "</div>";

    return $output;
}

function build_news_stories() {
    $output = "<div style='padding-top: 35px;'>";
    $output .= "  <img src='/sites/default/themes/custom/ferries/images/news-stories.jpg' style='width: 220px; height: 157px; padding-bottom: 8px;'>";
    $output .= "  <div>";
    $output .= "    <h2 class='l3-footer-pane-title'>News stories</h2>";
    $output .= "    <p>Check out our WSF Weekly Update and other news stories.</p>";
    $output .= "  </div>";
    $output .= "  <div>";
    $output .= "    <img src='/sites/default/themes/custom/ferries/images/bullet.png' style='float: right; padding: 10px;'>";
    $output .= "  </div>";
    $output .= "</div>";

    return $output;
}

function build_twitter() {
    $output = "<div style='padding-top: 35px;'>";
    $output .= "  <img src='/sites/default/themes/custom/ferries/images/twitter.jpg' style='width: 220px; height: 157px; padding-bottom: 8px;'>";
    $output .= "  <div>";
    $output .= "    <h2 class='l3-footer-pane-title'>Twitter</h2>";
    $output .= "    <p>Follow us <a href='https://twitter.com/wsferries'>@wsferries</a> for the best social media content you’ll find on the internet.</p>";
    $output .= "  </div>";
    $output .= "  <div>";
    $output .= "    <img src='/sites/default/themes/custom/ferries/images/bullet.png' style='float: right; padding: 10px;'>";
    $output .= "  </div>";
    $output .= "</div>";

    return $output;
}

/**
 * Implements hook_form_FORM_ID_alter().
 *
 * Need to don't see the parameters 'form_build_id' and 'form_id' in the url.
 */
function ferries_form_schedule_by_route_form_alter(&$form, &$form_state, $form_id) {
    unset($form['form_build_id'], $form['form_token'], $form['form_id']);
}

/**
 * Implements hook_form_FORM_ID_alter().
 *
 * Need to don't see the parameters 'form_build_id' and 'form_id' in the url.
 */
function ferries_form_make_reservations_form_alter(&$form, &$form_state, $form_id) {
    unset($form['form_build_id'], $form['form_token'], $form['form_id']);
}

/**
 * Implements hook_form_FORM_ID_alter().
 *
 * Need to don't see the parameters 'form_build_id' and 'form_id' in the url.
 */
function ferries_form_buy_tickets_form_alter(&$form, &$form_state, $form_id) {
    unset($form['form_build_id'], $form['form_token'], $form['form_id']);
}
